<%
// Carousel partial for reusable carousel functionality
// Parameters:
// - carouselId: unique ID for the carousel
// - items: array of items to display
// - type: 'character', 'episode', 'season' (affects how items are rendered)
// - options: optional object with slick carousel settings overrides
// - showModal: boolean to include modal functionality (default: true)
// - seasonNumber: for season type carousels

const defaultOptions = {
    infinite: true,
    slidesToShow: 3,
    slidesToScroll: 1,
    autoplay: true,
    autoplaySpeed: 4000,
    dots: true,
    arrows: true
};

const carouselOptions = Object.assign({}, defaultOptions, options || {});
const includeModal = showModal !== false; // Default to true unless explicitly set to false
%>

<section class="carousel-section">
    <div class="carousel" id="<%= carouselId %>">
        <% if (type === 'character' && items) { %>
            <% items.forEach(image => { %>
                <div>
                    <img src="<%= image %>" alt="Character Image" <%= includeModal ? 'class="carousel-image"' : '' %>>
                </div>
            <% }); %>
        <% } else if (type === 'episode' && items) { %>
            <% items.forEach(image => { %>
                <div>
                    <img src="<%= image %>" alt="Episode Image" <%= includeModal ? 'class="carousel-image"' : '' %>>
                </div>
            <% }); %>
        <% } else if (type === 'season' && items) { %>
            <% for (var episode in items) { %>
                <div>
                    <h3 class="episode-title">
                        <a href="/season/<%= seasonNumber %>/episode/<%= episode.replace('episode', '') %>">
                            <%= items[episode].title %>
                        </a>
                    </h3>
                    <a href="/season/<%= seasonNumber %>/episode/<%= episode.replace('episode', '') %>">
                        <img src="<%= items[episode].image %>" alt="<%= items[episode].title %>">
                    </a>
                    <p><%= items[episode].description %></p>
                    <a href="<%= items[episode].youtubeLink %>" target="_blank" class="youtube-link">Watch on YouTube</a>
                </div>
            <% } %>
        <% } %>
    </div>
</section>

<% if (includeModal) { %>
    <div id="imageModal" class="modal">
        <span class="modal-close">&times;</span>
        <img class="modal-content" id="fullSizeImage">
    </div>
<% } %>

<script>
    $(document).ready(function() {
        const options = <%- JSON.stringify(carouselOptions) %>;
        // Add responsive behavior for mobile
        options.slidesToShow = window.innerWidth <= 768 ? 2 : options.slidesToShow;
        $('#<%= carouselId %>').slick(options);
    });

    <% if (includeModal) { %>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('fullSizeImage');
        const closeModal = document.querySelector('.modal-close');

        document.querySelectorAll('#<%= carouselId %> .carousel-image').forEach(image => {
            image.addEventListener('click', () => {
                modal.style.display = 'block';
                modalImg.src = image.src;
            });
        });

        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
    <% } %>
</script>