<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <link rel="stylesheet" href="/css/modal_styles.css">
</head>
<body>
    <%- include('partials/header') %>

    <main>
        <section class="banner-image" style="background-image: url('<%= image %>'); background-size: cover; background-position: center; height: 300px;">
        </section>
        
        <nav class="episode-navigation" style="display: flex; justify-content: space-between; margin: 10px 20px;">
            <% if (previousLink) { %>
                <div style="text-align: left;">
                    <a href="<%= previousLink.url %>" class="prev-link">
                        &larr; <%= previousLink.title %>
                    </a>
                    <br />
                    <img src="<%= previousLink.image %>" alt="Previous Episode Image" style="width: 50px; height: auto;">
                </div>
            <% } %>

            <% if (nextLink) { %>
                <div style="text-align: right;">
                    <a href="<%= nextLink.url %>" class="next-link">
                        <%= nextLink.title %> &rarr;
                    </a>
                    <br />
                    <img src="<%= nextLink.image %>" alt="Next Episode Image" style="width: 50px; height: auto;">
                </div>
            <% } %>
        </nav>
        
        <h1><%= title %></h1>

        <section class="carousel">
            <div class="carousel-container" id="episode-carousel">
                <% carouselImages.forEach(image => { %>
                    <div>
                        <img src="<%= image %>" alt="Carousel Image">
                    </div>
                <% }); %>
            </div>
        </section>

        <div id="imageModal" class="modal">
            <span class="modal-close">&times;</span>
            <img class="modal-content" id="fullSizeImage">
        </div>

        <section class="summary">
            <h2>Summary</h2>
            <p><%= summary %></p>
        </section>

        <section class="audio-player">
            <h2>Listen to the Song</h2>
            <audio controls>
                <source src="<%= audioUrl %>" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </section>

        <section class="lyrics">
            <h2>Lyrics</h2>
            <em><%= lyrics %></em>
            <br /><br />
            <a href="<%= youtubeLink %>" target="_blank" class="watch-video-link">Watch the Video</a>
        </section>

        <br /><br />
    </main>

    <%- include('partials/footer') %>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#episode-carousel').slick({
                infinite: true,
                slidesToShow: 3,
                slidesToScroll: 1,
                autoplay: true,
                autoplaySpeed: 4000,
                dots: true,
                arrows: true
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('fullSizeImage');
            const closeModal = document.querySelector('.modal-close');

            document.querySelectorAll('#episode-carousel img').forEach(image => {
                image.addEventListener('click', () => {
                    modal.style.display = 'block';
                    modalImg.src = image.src;
                });
            });

            closeModal.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>