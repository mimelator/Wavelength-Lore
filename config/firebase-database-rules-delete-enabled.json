{
  "rules": {
    "lore": {
      ".read": true,
      ".write": "auth != null && auth.token.isScript == true"
    },
    "characters": {
      ".read": true,
      ".write": "auth != null && auth.token.isScript == true"
    },
    "episodes": {
      ".read": true,
      ".write": "auth != null && auth.token.isScript == true"
    },
    "videos": {
      ".read": true,
      ".write": "auth != null && auth.token.isScript == true"
    },
    "forum": {
      "categories": {
        ".read": true,
        ".write": "auth != null && auth.token.isScript == true"
      },
      "posts": {
        ".read": true,
        "$postId": {
          ".write": "auth != null && (!data.exists() || data.child('authorId').val() == auth.uid || auth.token.isScript == true)",
          ".validate": "!newData.exists() || newData.hasChildren(['title', 'content', 'authorId', 'authorName', 'createdAt', 'category'])",
          "title": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 200"
          },
          "content": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 10000"
          },
          "authorId": {
            ".validate": "newData.val() == auth.uid || auth.token.isScript == true"
          },
          "authorName": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "category": {
            ".validate": "newData.isString() && (newData.val() == 'general' || newData.val() == 'lore' || newData.val() == 'episodes' || newData.val() == 'fanart')"
          },
          "type": {
            ".validate": "newData.isString() && (newData.val() == 'discussion' || newData.val() == 'question' || newData.val() == 'theory' || newData.val() == 'fanart' || newData.val() == 'news')"
          },
          "tags": {
            ".validate": "newData.hasChildren() || !newData.exists()"
          },
          "createdAt": {
            ".validate": "newData.val() <= now"
          },
          "updatedAt": {
            ".validate": "newData.val() <= now"
          },
          "attachments": {
            ".validate": "newData.hasChildren() || !newData.exists()",
            "$attachmentIndex": {
              ".validate": "newData.hasChildren(['id', 'originalName', 'url', 'size', 'mimetype'])"
            }
          },
          "likedBy": {
            "$userId": {
              ".write": "auth != null && $userId == auth.uid",
              ".validate": "newData.val() == true || !newData.exists()"
            }
          },
          "likes": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "likeCount": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "replyCount": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "viewCount": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "views": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          }
        }
      },
      "replies": {
        ".read": true,
        "$replyId": {
          ".write": "auth != null && (!data.exists() || data.child('authorId').val() == auth.uid || auth.token.isScript == true)",
          ".validate": "!newData.exists() || newData.hasChildren(['content', 'postId', 'authorId', 'authorName', 'createdAt'])",
          "content": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 5000"
          },
          "postId": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "authorId": {
            ".validate": "newData.val() == auth.uid || auth.token.isScript == true"
          },
          "authorName": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "createdAt": {
            ".validate": "newData.val() <= now"
          },
          "likedBy": {
            "$userId": {
              ".write": "auth != null && $userId == auth.uid",
              ".validate": "newData.val() == true || !newData.exists()"
            }
          },
          "likes": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "likeCount": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          }
        }
      },
      "users": {
        "$userId": {
          ".read": "auth != null && (auth.uid == $userId || auth.token.isScript == true)",
          ".write": "auth != null && (auth.uid == $userId || auth.token.isScript == true)",
          ".validate": "!newData.exists() || newData.hasChildren(['displayName', 'email', 'joinedAt'])",
          "displayName": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
          },
          "email": {
            ".validate": "newData.isString() && newData.val().matches(/^[^@]+@[^@]+\\.[^@]+$/)"
          },
          "avatar": {
            ".validate": "newData.isString() || !newData.exists()"
          },
          "bio": {
            ".validate": "newData.isString() && newData.val().length <= 500"
          },
          "joinedAt": {
            ".validate": "newData.val() <= now"
          },
          "lastActive": {
            ".validate": "newData.val() <= now"
          },
          "postCount": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          },
          "replyCount": {
            ".validate": "newData.isNumber() && newData.val() >= 0"
          }
        }
      },
      "settings": {
        ".read": true,
        ".write": "auth != null && auth.token.isScript == true"
      },
      "moderation": {
        ".read": "auth != null && auth.token.isScript == true",
        ".write": "auth != null && auth.token.isScript == true"
      }
    },
    "analytics": {
      ".read": "auth != null && auth.token.isScript == true",
      ".write": "auth != null && auth.token.isScript == true"
    }
  }
}