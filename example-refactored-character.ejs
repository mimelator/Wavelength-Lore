<!-- Example: Refactored character.ejs using the carousel partial -->

<%- include('partials/header', { 
    pageTitle: `${character.title} - Wavelength Lore`,
    pageDescription: character.description || `Learn about ${character.title} from Wavelength.`,
    pageUrl: `${baseUrl}/character/${character.slug}`,
    pageImage: character.image_gallery && character.image_gallery[0] ? character.image_gallery[0] : `${baseUrl}/static/images/default-character.jpg`
}) %>

<body>
    <%- include('partials/navbar') %>

    <!-- Include carousel CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/carousel.css">

    <main class="character-page">
        <h1><%= character.title %></h1>

        <section class="character-info">
            <p><%- simpleSmartLinking(character.description) %></p>
        </section>

        <!-- Refactored carousel using the partial -->
        <% 
        // Shuffle images for variety
        const shuffledImages = character.image_gallery ? 
            character.image_gallery.sort(() => Math.random() - 0.5) : [];
        %>
        
        <%- include('partials/carousel', {
            carouselId: 'character-carousel',
            items: shuffledImages,
            type: 'character',
            showModal: true,
            options: {
                autoplay: true,
                autoplaySpeed: 4000,
                arrows: true,
                dots: true
            }
        }) %>

        <section class="character-episodes">
            <h2>Episodes Featuring <%= character.title %></h2>
            <% if (character.episodes && character.episodes.length > 0) { %>
                <ul>
                    <% character.episodes.forEach(episode => { %>
                        <li><a href="/season/<%= episode.season %>/episode/<%= episode.number %>"><%= episode.title %></a></li>
                    <% }); %>
                </ul>
            <% } else { %>
                <p>No episodes found featuring this character.</p>
            <% } %>
        </section>
    </main>

    <%- include('partials/footer') %>

    <!-- Include carousel JavaScript (only once) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

</body>
</html>